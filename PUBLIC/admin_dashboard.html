<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Dashboard | The Shots</title>

<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Poppins:wght@300;500&display=swap" rel="stylesheet">

<style>
body {
    margin:0;
    background:#0b0b0b;
    color:#fff;
    font-family:Poppins;
}

header {
    background:#111;
    padding:20px 40px;
    display:flex;
    justify-content:space-between;
    align-items:center;
}

h1,h2,h3 {
    font-family:Cinzel;
}

button {
    background:linear-gradient(120deg, crimson, gold);
    border:none;
    padding:10px 20px;
    cursor:pointer;
    font-weight:bold;
    transition:.3s;
}

button:hover {
    box-shadow:0 0 20px crimson;
    transform:scale(1.05);
}

section {
    padding:40px;
}

.card {
    background:#161616;
    padding:20px;
    border-radius:12px;
    margin-bottom:30px;
}

input, select, textarea {
    width:100%;
    padding:10px;
    margin:10px 0;
    background:#111;
    border:1px solid #333;
    color:#fff;
}

table {
    width:100%;
    border-collapse:collapse;
}

th, td {
    padding:12px;
    border-bottom:1px solid #333;
    text-align:left;
}

.status-PENDING { color:gold; }
.status-APPROVED { color:lime; }
.status-REJECTED { color:red; }
</style>
</head>

<body>

<header>
    <h1>Admin Dashboard</h1>
    <button onclick="logout()">Logout</button>
</header>

<section>

<!-- ================= STATS ================= -->
<div class="card">
<h3>System Overview</h3>
<p>Total Clients: <span id="totalUsers"></span></p>
<p>Total Services: <span id="totalServices"></span></p>
<p>Total Bookings: <span id="totalBookings"></span></p>
<p>Approved: <span id="approvedBookings"></span></p>
<p>Pending: <span id="pendingBookings"></span></p>
<p>Rejected: <span id="rejectedBookings"></span></p>
</div>

<!-- ================= BOOKINGS ================= -->
<div class="card">
<h3>Client Bookings</h3>
<table>
<thead>
<tr>
<th>Client</th>
<th>Service</th>
<th>Event Date</th>
<th>Status</th>
<th>Action</th>
</tr>
</thead>
<tbody id="bookingsTable"></tbody>
</table>
</div>

<!-- ================= SERVICES ================= -->
<div class="card">
<h3>Manage Services</h3>

<input id="service_name" placeholder="Service Name">
<input id="description" placeholder="Description">
<input id="price" type="number" placeholder="Price">
<button onclick="addService()">Add Service</button>

<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Price</th>
<th>Action</th>
</tr>
</thead>
<tbody id="servicesTable"></tbody>
</table>
</div>

<!-- ================= WORKS UPLOAD ================= -->
<div class="card">
<h3>Upload Works (MP4)</h3>

<form id="uploadForm" enctype="multipart/form-data">
<input name="title" placeholder="Title" required>

<select name="category">
<option>WEDDING</option>
<option>CORPORATE</option>
<option>EVENT</option>
<option>COMMERCIAL</option>
</select>

<input type="file" name="video" accept="video/mp4" required>
<textarea name="description" placeholder="Description"></textarea>

<button type="submit">Upload Video</button>
</form>
</div>

</section>

<script>
// ================= LOGOUT =================
function logout(){
    window.location.href = "login.html";
}

// ================= STATS =================
async function loadStats(){
    const res = await fetch("/api/dashboard-stats");
    const d = await res.json();

    totalUsers.textContent = d.totalUsers;
    totalServices.textContent = d.totalServices;
    totalBookings.textContent = d.totalBookings;
    approvedBookings.textContent = d.approvedBookings;
    pendingBookings.textContent = d.pendingBookings;
    rejectedBookings.textContent = d.rejectedBookings;
}

// ================= BOOKINGS =================
async function loadBookings(){
    const res = await fetch("/api/bookings");
    const data = await res.json();
    bookingsTable.innerHTML = "";

    data.forEach(b => {
        bookingsTable.innerHTML += `
        <tr>
            <td>${b.client_name}</td>
            <td>${b.service_name}</td>
            <td>${new Date(b.booking_date).toLocaleDateString()}</td>
            <td class="status-${b.status}">${b.status}</td>
            <td>
                <button onclick="updateBooking(${b.id}, 'APPROVED')">Approve</button>
                <button onclick="updateBooking(${b.id}, 'REJECTED')">Reject</button>
            </td>
        </tr>
        `;
    });
}

async function updateBooking(id, status){
    const res = await fetch(`/api/bookings/${id}/status`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ status })
    });

    const d = await res.json();
    alert(d.message);
    loadBookings();
    loadStats();
}

// ================= SERVICES =================
async function loadServices(){
    const res = await fetch("/api/services");
    const data = await res.json();
    servicesTable.innerHTML = "";

    data.forEach(s => {
        servicesTable.innerHTML += `
        <tr>
            <td>${s.service_name}</td>
            <td>${s.description}</td>
            <td>${s.price}</td>
            <td>
                <button onclick="deleteService(${s.id})">Delete</button>
            </td>
        </tr>
        `;
    });
}

async function addService(){
    if(!service_name.value || !description.value || !price.value){
        alert("All fields required");
        return;
    }

    const res = await fetch("/api/services", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            service_name: service_name.value,
            description: description.value,
            price: price.value
        })
    });

    const d = await res.json();
    alert(d.message);
    service_name.value = "";
    description.value = "";
    price.value = "";
    loadServices();
    loadStats();
}

async function deleteService(id){
    if(!confirm("Delete this service?")) return;
    await fetch(`/api/services/${id}`, { method:"DELETE" });
    loadServices();
    loadStats();
}

// ================= WORKS UPLOAD =================
uploadForm.addEventListener("submit", async e => {
    e.preventDefault();
    const formData = new FormData(uploadForm);

    const res = await fetch("/api/works/upload", {
        method:"POST",
        body: formData
    });

    const d = await res.json();
    alert(d.message);
    uploadForm.reset();
});

// ================= INIT =================
loadStats();
loadBookings();
loadServices();
</script>


</body>
</html>
